<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Record 3a ‚Äî Incoming Goods</title>
  <link rel="stylesheet" href="shared/styles.css">
</head>
<body>
  <div class="mdk-wash"></div>

  <main class="mdk-wrap">
    <!-- Toolbar -->
<nav class="mdk-toolbar">
  <a class="mdk-btn mdk-btn--back" href="kitchen.html">‚Üê Back</a>
  <button class="mdk-btn" onclick="window.print()">üñ® Print</button>
  <button class="mdk-btn" onclick="clearForm()">‚úñ Clear</button>
  <button class="mdk-btn mdk-btn--primary" onclick="saveForm()">üíæ Save</button>
</nav>
    <h1>Record 3a ‚Äî Incoming Goods</h1>

    <!-- Meta -->
    <div class="mdk-meta">
      <label>Date: <input type="date" id="date"></label>
      <label>Supplier: <input type="text" id="supplier" placeholder="Company name"></label>
      <label>Receiver (Initials): <input type="text" id="receiver" maxlength="3" placeholder=""></label>
    </div>

    <!-- Table -->
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Batch / Lot</th>
          <th>Temp (¬∞C)</th>
          <th>Accept / Reject</th>
          <th>Initials</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody id="rows">
        <!-- rows injected -->
      </tbody>
    </table>

    <!-- Guidance text (as in Food Safety Program) -->
    <div class="note" style="text-align:left; margin-top:12px">
      <b>Temperature information</b><br>
      ‚Ä¢ Cold foods ‚Äì at or below 5 ¬∞C &nbsp;&nbsp; ‚Ä¢ Frozen foods ‚Äì frozen hard (not partially thawed) &nbsp;&nbsp; ‚Ä¢ Hot foods ‚Äì at or above 60 ¬∞C
      <br><br>
      <b>Designated storage areas</b><br>
      Store incoming goods promptly in: Refrigerators/Freezers, Dry storage, or Hot holding equipment (as appropriate).
      <br><br>
      <b>Visual check</b><br>
      ‚Ä¢ Use by / Best before date &nbsp;&nbsp; ‚Ä¢ Packaging (not damaged/deteriorated/perished; appropriate material)<br>
      ‚Ä¢ Labelling (name of food, supplier name & address, lot identification) &nbsp;&nbsp; ‚Ä¢ Pest contamination &nbsp;&nbsp; ‚Ä¢ Foreign objects
    </div>
  </main>

  <script>
    // ---- Build 10 blank rows
    const LINES = 10;
    const tbody = document.getElementById('rows');

    function addRow(){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input data-k="item" placeholder="Description of goods"></td>
        <td><input data-k="lot" placeholder="Batch / Lot"></td>
        <td><input type="number" step="0.1" data-k="temp" placeholder="¬∞C"></td>
        <td>
          <select data-k="accept">
            <option value=""></option>
            <option>Accept</option>
            <option>Reject</option>
          </select>
        </td>
        <td><input data-k="init" maxlength="3" placeholder=""></td>
        <td><input data-k="note" placeholder="Notes / corrective action"></td>
      `;
      return tr;
    }

    for (let i=0; i<LINES; i++) tbody.appendChild(addRow());

    // ---- Simple Save / Load (sessionStorage for now)
    const dateEl = document.getElementById('date');
    const supplierEl = document.getElementById('supplier');
    const receiverEl = document.getElementById('receiver');
    const CACHE_KEY = 'mdk_record3a_cache';

    function serialize(){
      const rows = [...tbody.querySelectorAll('tr')].map(tr=>{
        const get = k => tr.querySelector(`[data-k="${k}"]`)?.value || '';
        return {
          item: get('item'),
          lot: get('lot'),
          temp: get('temp'),
          accept: get('accept'),
          init: get('init'),
          note: get('note')
        };
      });
      return {
        date: dateEl.value || '',
        supplier: supplierEl.value || '',
        receiver: receiverEl.value || '',
        rows
      };
    }

    function hydrate(data){
      if(!data) return;
      dateEl.value = data.date || '';
      supplierEl.value = data.supplier || '';
      receiverEl.value = data.receiver || '';
      const trs = [...tbody.querySelectorAll('tr')];
      (data.rows || []).forEach((r, i)=>{
        const set = (k,v)=>{ const el = trs[i]?.querySelector(`[data-k="${k}"]`); if(el) el.value = v || ''; };
        set('item', r.item);
        set('lot', r.lot);
        set('temp', r.temp);
        set('accept', r.accept);
        set('init', r.init);
        set('note', r.note);
      });
    }

    function saveForm(){
      try{
        sessionStorage.setItem(CACHE_KEY, JSON.stringify(serialize()));
        alert('Saved (temporary).');
      }catch(e){ alert('Could not save'); }
    }

    function clearForm(){
      document.querySelectorAll('input, select, textarea').forEach(el=>{
        if(el.type==='checkbox' || el.type==='radio'){ el.checked = false; }
        else { el.value = ''; }
      });
      try{ sessionStorage.removeItem(CACHE_KEY); }catch(e){}
    }

    (function init(){
      try{
        const raw = sessionStorage.getItem(CACHE_KEY);
        if(raw) hydrate(JSON.parse(raw));
      }catch(e){}
    })();
  </script>
</body>
</html>
