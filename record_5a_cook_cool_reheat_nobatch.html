<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Record 5a ‚Äî Temperature Control Log ‚Äî Cook/Cool/Reheat & Serve</title>
<style>
  :root{
    --ink:#0f172a; --muted:#64748b; --line:#cfd6dd; --grid:#e7edf3; --head:#f6f8fb;
    --chip:#eef2f7; --brand:#0d6efd; --warn:#ffc107; --ok:#16a34a;
    --fs:13px;
  }
  @page{ size:A4 portrait; margin:12mm }
  html,body{margin:0;background:#e8f0f4;color:var(--ink);font:var(--fs)/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  body{
    background-image:url("kitchen.jpg");
    background-size:cover;background-attachment:fixed;background-position:center;
  }
  .wash{position:fixed;inset:0;background:rgba(255,255,255,.88);z-index:-1}
  .wrap{max-width:1000px;margin:22px auto;padding:0 14px}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 28px rgba(2,6,23,.10);padding:16px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .btn{border:0;border-radius:12px;background:var(--chip);padding:9px 14px;font-weight:700;cursor:pointer;color:#0f172a;display:flex;align-items:center;gap:8px;box-shadow:0 2px 6px rgba(2,6,23,.06)}
  .btn:hover{filter:brightness(.97)}
  .btn--back{background:var(--warn)}
  .btn--primary{background:var(--brand);color:#fff}
  h1{margin:8px 0 12px;font-size:20px;text-align:center}
  .meta{display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:center;margin:8px 0 14px}
  label{font-weight:700}
  input, select, textarea{
    border:1px solid var(--line);border-radius:10px;padding:8px 10px;background:#fff
  }
  input[type="date"], input[type="time"], input[type="month"] { min-width:150px }
  .row{display:grid;grid-template-columns:repeat(12,1fr);gap:8px}
  .row + .row{margin-top:8px}
  .full{grid-column:1/-1}
  .note{font-size:12px;color:var(--muted);margin-top:10px}
  .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#eef2f7;border:1px solid var(--line)}
  .recTime{font-weight:700;color:var(--ok)}
  .group{border:1px dashed var(--line);border-radius:12px;padding:12px;background:#fff}
  .legend{font-weight:800;margin:0 0 8px}
  table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:12px;overflow:hidden}
  th,td{border-right:1px solid var(--grid);border-bottom:1px solid var(--grid);padding:8px 10px;background:#fff;vertical-align:middle}
  thead th{background:var(--head);text-align:left}
  tr:last-child td{border-bottom:0}
  th:last-child,td:last-child{border-right:0}
  .sr-only{position:absolute;left:-9999px}
  @media print{ .toolbar{display:none} body{background:#fff} .wash{display:none} }
</style>
</head>
<body>
<div class="wash"></div>
<div class="wrap card">

  <!-- Toolbar -->
  <div class="toolbar">
    <a href="kitchen.html" class="btn btn--back">‚Üê Back</a>
    <button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>
    <button class="btn" id="btnClear">‚úñÔ∏è Clear</button>
    <button class="btn btn--primary" id="btnSave">üíæ Save</button>
    <span class="badge">Recorded at: <span id="recordedAt" class="recTime">‚Äî</span></span>
    <div style="flex:1"></div>
    <label class="badge" style="background:#fff;border:none">Month:&nbsp;<input type="month" id="archiveMonth"></label>
    <button class="btn" id="btnLoadMonth">üìÇ Load Month</button>
    <button class="btn" id="btnArchive">üì¶ Archive Month</button>
  </div>

  <h1>Record 5a ‚Äî Temperature Control Log ‚Äî Cook/Cool/Reheat &amp; Serve</h1>

  <!-- Top meta row -->
  <div class="meta">
    <label>Date: <input type="date" id="date"></label>
    <label>Item: <input type="text" id="item" placeholder="Menu Item / Food"></label>
    <label>Produced/Batch No: <input type="text" id="batch"></label>
  </div>

  <!-- PROCESS per wording in Food Safety Program -->
  <div class="group">
    <p class="legend">Process (select all that apply ‚Äî wording per program):</p>
    <div class="row full">
      <label><input type="checkbox" name="process" value="Cook 75¬∞C"> Cook 75¬∞C</label>
      <label><input type="checkbox" name="process" value="Reheat 60¬∞C"> Reheat 60¬∞C</label>
      <label><input type="checkbox" name="process" value="Cool 60-21¬∞C in 2 hrs"> Cool 60-21¬∞C in 2 hrs</label>
      <label><input type="checkbox" name="process" value="21-5¬∞C in 4 hrs"> 21-5¬∞C in 4 hrs</label>
      <label><input type="checkbox" name="process" value="Serve"> Serve</label>
    </div>
  </div>

  <!-- Description + Ck/Cl/Rh -->
  <div class="row" style="margin-top:10px">
    <div class="full">
      <label for="desc">Description</label>
      <textarea id="desc" rows="2" placeholder="Description of item/process"></textarea>
    </div>
    <div class="full">
      <span style="font-weight:800">Cook (Ck) Cool (Cl) Reheat (Rh):</span>
      <label style="margin-left:12px"><input type="checkbox" name="ckclrh" value="Ck"> Ck</label>
      <label style="margin-left:12px"><input type="checkbox" name="ckclrh" value="Cl"> Cl</label>
      <label style="margin-left:12px"><input type="checkbox" name="ckclrh" value="Rh"> Rh</label>
    </div>
  </div>

  <!-- Times & Temperatures table (verbatim headings) -->
  <table style="margin-top:12px">
    <thead>
      <tr>
        <th>Start Time</th>
        <th>Finish Time</th>
        <th>Temp ¬∞C</th>
        <th>Time 1</th>
        <th>Temp ¬∞C (60¬∞)</th>
        <th>Time 2</th>
        <th>Temp ¬∞C (21¬∞)</th>
        <th>Time 3</th>
        <th>Temp ¬∞C (5¬∞)</th>
        <th>Time</th>
        <th>Temp ¬∞C</th>
        <th>Initial</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="time" id="startTime"></td>
        <td><input type="time" id="finishTime"></td>
        <td><input type="number" id="tempFinal" step="0.1" placeholder="e.g. 75.0"></td>
        <td><input type="time" id="time1"></td>
        <td><input type="number" id="temp60" step="0.1" placeholder="60.0"></td>
        <td><input type="time" id="time2"></td>
        <td><input type="number" id="temp21" step="0.1" placeholder="21.0"></td>
        <td><input type="time" id="time3"></td>
        <td><input type="number" id="temp5" step="0.1" placeholder="5.0"></td>
        <td><input type="time" id="serveTime"></td>
        <td><input type="number" id="serveTemp" step="0.1"></td>
        <td><input type="text" id="initials" placeholder="Staff Sign"></td>
      </tr>
    </tbody>
  </table>

  <div class="note">
    <b>Note:</b> Headings and wording match the Food Safety Program Record 5a exactly. Temperature targets & cooling timeframes align with the program requirements. Ó®Å2Ó®Ç
  </div>
</div>

<!-- Firebase SDKs (script-tag version) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
/* ------------------  Firebase CONFIG (paste yours)  ------------------ */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
/* -------------------------------------------------------------------- */

const $ = id => document.getElementById(id);
const recordedAtEl = $('recordedAt');
const archiveMonth = $('archiveMonth');

/* Utility */
function ymd(date){ const d = new Date(date); const z=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`;}
function ym(date){ const d = new Date(date); const z=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${z(d.getMonth()+1)}`;}
function nowLocal(){ const d = new Date(); return d.toLocaleString(); }

/* Collect form data with exact labels */
function getProcesses(){ return Array.from(document.querySelectorAll('input[name=process]:checked')).map(x=>x.value); }
function getCkClRh(){ return Array.from(document.querySelectorAll('input[name=ckclrh]:checked')).map(x=>x.value); }

function readForm(){
  return {
    // Official labels per program:
    Date: $('date').value || null,
    Item: $('item').value || '',
    "Produced/Batch No": $('batch').value || '',
    Process: getProcesses(),                              // Cook 75¬∞C, Reheat 60¬∞C, Cool 60-21‚Ä¶ etc
    Description: $('desc').value || '',
    "Cook (Ck) Cool (Cl) Reheat (Rh)": getCkClRh(),       // ['Ck','Cl','Rh'] subset

    // Times & Temps block (verbatim headings)
    "Start Time": $('startTime').value || null,
    "Finish Time": $('finishTime').value || null,
    "Temp ¬∞C": Number($('tempFinal').value || 0) || null,
    "Time 1": $('time1').value || null,
    "Temp ¬∞C (60¬∞)": Number($('temp60').value || 0) || null,
    "Time 2": $('time2').value || null,
    "Temp ¬∞C (21¬∞)": Number($('temp21').value || 0) || null,
    "Time 3": $('time3').value || null,
    "Temp ¬∞C (5¬∞)": Number($('temp5').value || 0) || null,
    "Time": $('serveTime').value || null,
    "Temp ¬∞C (serve)": Number($('serveTemp').value || 0) || null,
    "Initial": $('initials').value || '',

    // Stamps
    recordedAtLocal: nowLocal(),                          // visible stamp
    savedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
}

/* Paths */
function monthColl(monthStr){ return `record5a/${monthStr}`; }
function archiveDoc(monthStr){ return `archives/record5a/${monthStr}`; }

/* Save one entry (document) inside month collection) */
async function saveEntry(){
  const monthKey = ym($('date').value || new Date());
  const data = readForm();

  // Minimal guard: program requires target temps/cooling windows; basic nudge
  if(!data.Date){ alert('Please set Date.'); return; }
  if(!data.Item){ alert('Please enter Item.'); return; }

  await db.collection(monthColl(monthKey)).add(data);
  recordedAtEl.textContent = data.recordedAtLocal;
  alert('Saved to Firestore ‚úÖ');
}

/* Load Month (read-only printable view) */
async function loadMonth(){
  const m = archiveMonth.value;
  if(!m){ alert('Choose a Month first.'); return; }
  const snap = await db.collection(monthColl(m)).get();

  const rows = [];
  snap.forEach(doc => rows.push({id:doc.id, ...doc.data()}));
  rows.sort((a,b)=> (a.Date||'').localeCompare(b.Date||'') || (a['Start Time']||'').localeCompare(b['Start Time']||''));

  const w = window.open('', '_blank');
  const css = `
    body{font-family:system-ui,Segoe UI,Arial;margin:20px}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #cfd6dd;padding:6px 8px;vertical-align:top}
    thead th{background:#f6f8fb}
    h2{margin:0 0 8px}
  `;
  w.document.write(`<html><head><title>Record 5a ‚Äî ${m}</title><style>${css}</style></head><body>`);
  w.document.write(`<h2>Record 5a ‚Äî Temperature Control Log ‚Äî ${m}</h2>`);
  w.document.write('<table><thead><tr>' +
    ['Date','Item','Produced/Batch No','Process','Description','Ck/Cl/Rh','Start Time','Finish Time','Temp ¬∞C','Time 1','Temp ¬∞C (60¬∞)','Time 2','Temp ¬∞C (21¬∞)','Time 3','Temp ¬∞C (5¬∞)','Time','Temp ¬∞C (serve)','Initial','Recorded at'].map(h=>`<th>${h}</th>`).join('')
    + '</tr></thead><tbody>');
  rows.forEach(r=>{
    w.document.write('<tr>' +
      [
        r.Date||'', r.Item||'', r['Produced/Batch No']||'',
        (r.Process||[]).join(', '), r.Description||'',
        (r['Cook (Ck) Cool (Cl) Reheat (Rh)']||[]).join(', '),
        r['Start Time']||'', r['Finish Time']||'', (r['Temp ¬∞C']??''),
        r['Time 1']||'', (r['Temp ¬∞C (60¬∞)']??''), r['Time 2']||'', (r['Temp ¬∞C (21¬∞)']??''),
        r['Time 3']||'', (r['Temp ¬∞C (5¬∞)']??''), r['Time']||'', (r['Temp ¬∞C (serve)']??''), r['Initial']||'',
        r['recordedAtLocal']||''
      ].map(v=>`<td>${v===null?'':v}</td>`).join('') + '</tr>');
  });
  w.document.write('</tbody></table></body></html>');
  w.document.close(); w.focus();
}

/* Archive Month (snapshot month -> archives/record5a/{YYYY-MM}) */
async function archiveMonthData(){
  const m = archiveMonth.value;
  if(!m){ alert('Choose a Month first.'); return; }
  const snap = await db.collection(monthColl(m)).get();
  const entries = []; snap.forEach(doc=> entries.push({id:doc.id, ...doc.data()}));
  await db.doc(archiveDoc(m)).set({
    month:m,
    entries,
    archivedAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  alert(`Archived ${entries.length} entr${entries.length===1?'y':'ies'} to ${m}.`);
}

/* UI events */
$('btnSave').addEventListener('click', saveEntry);
$('btnLoadMonth').addEventListener('click', loadMonth);
$('btnArchive').addEventListener('click', archiveMonthData);
$('btnClear').addEventListener('click', ()=>{
  document.querySelectorAll('input[type=text], input[type=number], textarea').forEach(el=> el.value='');
  document.querySelectorAll('input[type=time], input[type=date]').forEach(el=> el.value='');
  document.querySelectorAll('input[type=checkbox]').forEach(el=> el.checked=false);
  recordedAtEl.textContent = '‚Äî';
});

/* Defaults */
(function init(){
  const t = new Date();
  $('date').value = ymd(t);
  archiveMonth.value = ym(t);
  recordedAtEl.textContent = '‚Äî';
})();
</script>
</body>
</html>
